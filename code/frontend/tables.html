<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2"
    crossorigin="anonymous"></script>

  <script src="https://code.jquery.com/jquery-1.11.1.min.js"
    integrity="sha384-UM1JrZIpBwVf5jj9dTKVvGiiZPZTLVoq4sfdvIe9SBumsvCuv6AHDNtEiIb5h1kU"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.11.1/jquery-ui.min.js"
    integrity="sha384-ovZOciNc/R4uUo2fCVS1oDT0vIBuaou1d39yqL4a9xFdZAYDswCgrJ6tF8ShkqzF"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />

  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="icon" type="png" href="img/other/logo.png">
  <title>Statistiche Giocatore e Classifica</title>
</head>

<body>

  <aside>
    <div id="nav_colomn" class="full d-flex flex-column flex-shrink-0 p-3" style="width: 250px;">
      <div class="mb-3">
        <a href="/" class="d-flex align-items-center title_nav">
          <img class="title_nav_pic" src="img/other/logo.png" alt="logo" width="50" height="50"
            class="d-inline-block align-top mr-2">
          <span id="btn_nav_home" class="h4 m-0 items-center btn_nav_home" style="color: #cacaca">Silver Bullets</span>
        </a>
        <hr id="linea" style="border-color: #cacaca; height: 2px;">
      </div>

      <ul id="nav_btn" class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
          <a href="board.html" class="nav-link" aria-current="page">
            <svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" fill="currentColor" class="bi bi-play"
              viewBox="0 0 16 16">
              <path
                d="M10.804 8 5 4.633v6.734zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696z" />
            </svg>
            <div id="btn_nav_play">
              Play
            </div>
          </a>
        </li>

        <li class="nav-item">
          <a href="rules.html" class="nav-link" aria-current="page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-book"
              viewBox="0 0 16 16">
              <path
                d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783" />
            </svg>
            <div id="btn_nav_rule">
              Rules
            </div>
          </a>
        </li>
        <li class="nav-item">
          <a href="tables.html" id="a-leaderboard" class="nav-link" aria-current="page">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trophy"
              viewBox="0 0 16 16">
              <path
                d="M2.5.5A.5.5 0 0 1 3 0h10a.5.5 0 0 1 .5.5q0 .807-.034 1.536a3 3 0 1 1-1.133 5.89c-.79 1.865-1.878 2.777-2.833 3.011v2.173l1.425.356c.194.048.377.135.537.255L13.3 15.1a.5.5 0 0 1-.3.9H3a.5.5 0 0 1-.3-.9l1.838-1.379c.16-.12.343-.207.537-.255L6.5 13.11v-2.173c-.955-.234-2.043-1.146-2.833-3.012a3 3 0 1 1-1.132-5.89A33 33 0 0 1 2.5.5m.099 2.54a2 2 0 0 0 .72 3.935c-.333-1.05-.588-2.346-.72-3.935m10.083 3.935a2 2 0 0 0 .72-3.935c-.133 1.59-.388 2.885-.72 3.935M3.504 1q.01.775.056 1.469c.13 2.028.457 3.546.87 4.667C5.294 9.48 6.484 10 7 10a.5.5 0 0 1 .5.5v2.61a1 1 0 0 1-.757.97l-1.426.356a.5.5 0 0 0-.179.085L4.5 15h7l-.638-.479a.5.5 0 0 0-.18-.085l-1.425-.356a1 1 0 0 1-.757-.97V10.5A.5.5 0 0 1 9 10c.516 0 1.706-.52 2.57-2.864.413-1.12.74-2.64.87-4.667q.045-.694.056-1.469z" />
            </svg>

            <div id="btn_nav_lead">
              Leaderboard
            </div>
          </a>
        </li>

        <!-- Separators -->
        <li class="nav-item">
        </li>
        <li class="nav-item">
        </li>

        <li class="nav-item">
          <a href="#" class="nav-link" aria-current="page" id="collapse">
            <svg id="left_a" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#D5DBBE"
              class="bi bi-chevron-left" viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
            </svg>
            <svg id="right_a" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#D5DBBE"
              class="bi bi-chevron-right" viewBox="0 0 16 16">
              <path fill-rule="evenodd"
                d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708" />
            </svg>
            <div id="btn_nav_collapse">
              Collapse
            </div>
          </a>
        </li>


      </ul>

      <div class="user d-flex flex-column align-items-center"></div>
    </div>
  </aside>

  <div>
    <div class="container_a">
      <h1 style="margin-top: 30px; padding-right: 70px;">Statistiche Giocatore e Classifica</h1>

      <div id="playerStatsTable" class="stats_player">
        <h2>Statistiche del giocatore</h2>

        <div id="playerStats" class="table_stats_player">
          <div class="class_stat_player_header">
            <div class="title_User">Username</div>
            <div class="title_Vic">Victory</div>
            <div class="title_Def">Defeat</div>
            <div class="title_Drw">Draw</div>
            <div class="title_Elo">Elo</div>
          </div>

        </div>


      </div>

      <div id="leaderboardTable" class="stats_leaderboard">
        <h2>Classifica</h2>

        <div class="class_stat_leaderboard_header">
          <div class="title_User">Username</div>
          <div class="title_Vic">Victory</div>
          <div class="title_Def">Defeat</div>
          <div class="title_Drw">Draw</div>
          <div class="title_Elo">Elo</div>
        </div>

        <div class="columns_leaderbord">
          <div id="top10" class="players_position"></div>
          <div class="number_position">
            <div id="number1" class="number_top3">1</div>
            <div id="number2" class="number_top3">2</div>
            <div id="number3" class="number_top3">3</div>
            <div id="number4" class="number">4</div>
            <div id="number5" class="number">5</div>
            <div id="number6" class="number">6</div>
            <div id="number7" class="number">7</div>
            <div id="number8" class="number">8</div>
            <div id="number9" class="number">9</div>
            <div id="number10" class="number">10</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="module" src="js/utils.js"></script>
  <script type="module" src="js/script.js"></script>

  <script type="module">
    import { fetchPlayerLocStats, fetchLeaderboard, checkLogin } from './js/script.js';
    var counter = 0;
    var players_top10 = new Array(10);

    function insert_row(player_name, n_wins, n_lost, n_draws, elo) {
      var playerId = 'container' + new Date().getTime();
      var playerHTML = `
            <div id="${playerId}" class="class_stat_player" class="row" aria-live="assertive" aria-atomic="true">
            
              <div class="User">
                ${player_name}
              </div>
              <div class="Vic">
                ${n_wins}
              </div>
              <div class="Def">
                ${n_lost}
              </div>
              <div class="Drw">
                ${n_draws}
              </div>
              <div class="Elo">
                ${elo}
              </div>
            </div>
          `;
      document.getElementById('playerStats').insertAdjacentHTML('beforeend', playerHTML);
      document.getElementById(playerId).style.display = 'flex';
    }

    function insert_in_leaderboard(player_name, n_wins, n_lost, n_draws, elo) {
      if (counter < 10) {
        var playerId = 'container' + new Date().getTime();
        var playerHTML = `
        <div id="${playerId}" class="class_leader_player" aria-live="assertive" aria-atomic="true">
        
          <div class="User">
            ${player_name}
          </div>
          <div class="Vic">
            ${n_wins}
          </div>
          <div class="Def">
            ${n_lost}
          </div>
          <div class="Drw">
            ${n_draws}
          </div>
          <div class="Elo">
            ${elo}
          </div>
        </div>
        `;

        // Aggiungi il messaggio toast al contenitore
        $('#top10').append(playerHTML);


        switch (counter) {
          case 0:
            $('#number1').css('display', 'block');
            break;
          case 1:
            $('#number2').css('display', 'block');
            break;
          case 2:
            $('#number3').css('display', 'block');
            break;
          case 3:
            $('#number4').css('display', 'block');
            break;
          case 4:
            $('#number5').css('display', 'block');
            break;
          case 5:
            $('#number6').css('display', 'block');
            break;
          case 6:
            $('#number7').css('display', 'block');
            break;
          case 7:
            $('#number8').css('display', 'block');
            break;
          case 8:
            $('#number9').css('display', 'block');
            break;
          case 9:
            $('#number10').css('display', 'block');
            break;
        }

        players_top10[counter] = playerId;
        console.log(players_top10[counter]);
        counter++;
      }

    }

    function remove_from_leaderboard() {
      if (counter > 0) {
        var playerId = players_top10[counter - 1];
        $('#' + playerId).remove();
        counter--;
        switch (counter) {
          case 0:
            $('#number1').css('display', 'none');
            break;
          case 1:
            $('#number2').css('display', 'none');
            break;
          case 2:
            $('#number3').css('display', 'none');
            break;
          case 3:
            $('#number4').css('display', 'none');
            break;
          case 4:
            $('#number5').css('display', 'none');
            break;
          case 5:
            $('#number6').css('display', 'none');
            break;
          case 6:
            $('#number7').css('display', 'none');
            break;
          case 7:
            $('#number8').css('display', 'none');
            break;
          case 8:
            $('#number9').css('display', 'none');
            break;
          case 9:
            $('#number10').css('display', 'none');
            break;
        }
      }
    }

    function swapContainers(firstContainer, secondContainer) {
      if (firstContainer < 1 || firstContainer > 10 || secondContainer < 1 || secondContainer > 10) {
        return;
      }
      var id1 = players_top10[firstContainer - 1];
      var id2 = players_top10[secondContainer - 1];

      players_top10[firstContainer - 1] = id2;
      players_top10[secondContainer - 1] = id1;

      var div1 = document.getElementById(id1);
      var div2 = document.getElementById(id2);

      // Clona il primo div e inserisce il clone prima del secondo div
      var cloneDiv1 = div1.cloneNode(true);
      div2.parentNode.insertBefore(cloneDiv1, div2);

      // Clona il secondo div e inserisce il clone prima del primo div
      var cloneDiv2 = div2.cloneNode(true);
      div1.parentNode.insertBefore(cloneDiv2, div1);

      // Rimuove i div originali
      div1.parentNode.removeChild(div1);
      div2.parentNode.removeChild(div2);
    }

    // Funzione per ottenere dati del giocatore e della classifica quando la pagina si carica tramite richieste HTTP
    window.onload = function () {
      let User = 'guest';
      checkLogin().then(user => {
        console.log("user: ", user);
        User = user.username;

        fetchPlayerLocStats(User).then((stats) => {
          insert_row(stats.player_name, stats.n_wins, stats.n_lost, stats.n_draws, stats.elo);
        });
      });

      fetchLeaderboard().then(leaderboardData => {
        console.log("leaderboardData: ", leaderboardData);
        // Itera sui dati della leaderboard per inserirli nella tabella HTML
        leaderboardData.leaderboard.forEach(player => {
          insert_in_leaderboard(player.player_name, player.n_wins, player.n_lost, player.n_draws, player.elo);
        });
      });
    }

  </script>
  <script type="module">

    import { checkLogin } from './js/script.js'
    let nav_small = false;

    function smalernav() {
      if (!nav_small) {
        $('#btn_nav_play, #btn_nav_rule, #btn_nav_lead, #btn_nav_collapse, #btn_nav_home, .user, #left_a').css('display', 'none');
        $('#right_a').css('display', 'block');
        $('#nav_colomn').css('width', '95px');
        $('#nav_colomn').css('transition', 'width 0.5s');
        $('.container_a').css('margin-left', '120px');
        $('.container_a').css('transition', 'margin-left 0.5s');
        $('.title_nav_pic').css('margin-right', '0');
        $('.nav-link, .title_nav').css('justify-content', 'center');
        nav_small = true;
      } else {
        $('#btn_nav_play, #btn_nav_rule, #btn_nav_lead, #btn_nav_collapse, #btn_nav_home, #left_a').css('display', 'block');
        $('#right_a').css('display', 'none');
        $('#nav_colomn').css('transition', 'width 0.5s');
        $('#nav_colomn').css('width', '250px');
        $('.container_a').css('margin-left', '280px');
        $('.nav-link, .title_nav').css('justify-content', 'start');
        setTimeout(sigIn_btn, 500);
        nav_small = false;
      }
    }

    function sigIn_btn() {
      if (!nav_small) {
        $('.user').css('display', 'block');
      }
    }

    resize_nav();
    $(window).resize(function () {
      resize_nav();
    });

    function resize_nav() {
      console.log('resize called');
      var width = $(window).width();
      if (width < 1180) {
        $('#nav_colomn').removeClass('flex-column');
        $('#nav_btn').removeClass('flex-column');
        $('#nav_colomn').addClass('flex-row fixed-top navbar-dark');
        $('#nav_btn').removeClass('ml-auto flex-row');
        $('aside').addClass('flex-row');
        $('.title_nav_pic').css('margin-top', '16px');
        $('#nav_btn').css('justify-content', 'center');
        $('#nav_colomn').css('width', '100%');
        $('#nav_colomn').css('height', '60px');
        $('#nav_colomn').css('overflow', 'hidden');
        $('#btn_nav_play, #btn_nav_rule, #btn_nav_lead, #btn_nav_collapse, #btn_nav_home, #left_a, #right_a, #linea').css('display', 'none');
        $('.user').removeClass('mt-auto');
        $('#nav_colomn').css('justify-content', 'space-between');
        $('#nav_colomn').addClass('nav_shrink');
        $('#nav_colomn').css('transition', 'width 0s');

        $('.user').css('display', 'none');
        checkLogin().then(data => {
            if (data.loggedIn) {
                $('#name_user').css('display', 'none');
            }
        });
        if (nav_small) {
            $('.user').css('display', 'block');
        }
        $('.container_a').css('margin-top', '50px');
        $('.container_a').css('margin-left', '0px');


      } else {
        $('#nav_colomn').removeClass('flex-row fixed-top navbar-dark');
        $('#nav_btn').removeClass('fixed-top');
        $('#nav_btn').removeClass('flex-row');
        $('#nav_colomn').addClass('flex-column');
        $('#nav_btn').addClass('flex-column');
        $('aside').removeClass('flex-row');
        $('.title_nav_pic').css('margin-top', '0');
        $('#nav_btn').css('justify-content', 'start');
        $('#nav_colomn').css('height', '100%');
        $('#nav_colomn').css('overflow', 'auto');
        $('#right_a').css('display', 'none');
        $('.user').addClass('mt-auto');
        $('#nav_colomn').css('justify-content', 'start');
        $('#nav_colomn').removeClass('nav_shrink');
        $('#nav_colomn').css('transition', 'width 0s');

        checkLogin().then(data => {
          if (data.loggedIn) {
            $('#name_user').css('display', 'block');
          }
        });
        if (nav_small) {
          $('.container_a').css('margin-left', '120px');
          $('#nav_colomn').css('width', '95px');
          $('#right_a, #linea').css('display', 'block');
          $('.user').css('display', 'none');
        } else {
          $('.container_a').css('margin-left', '280px');
          $('#nav_colomn').css('width', '250px');
          $('#btn_nav_play, #btn_nav_rule, #btn_nav_lead, #btn_nav_collapse, #btn_nav_home, #left_a, #linea').css('display', 'block');
        }
        $('.container_a').css('margin-top', '0');

      }
    }
    window.addEventListener('load', () => resize_nav()); // This thing might break something, so remove it if it does
    // window.addEventListener('resize', () => resize_nav());
    document.getElementById("collapse").addEventListener("click", () => smalernav());

  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"
    integrity="sha384-v5sCAl8qZOHabzoh1+noJcE2yaDE9V/9+mBHgmxFdpiY5chhD/Qf1rQ7igh8ew0q"
    crossorigin="anonymous"></script>
</body>

</html>